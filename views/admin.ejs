<!DOCTYPE html>
<html lang="en">

<head>
<%- include('header'); %>
  <title>odette.rsvp - my events</title>
  <%- include('admin-preload'); %>
</head>

<body>
  <header class="container">
    <h1>ðŸ’Œ odette.rsvp</h1>
  </header>
  <main class="container">
    <article>
      <header>
        <h2>My events</h2>
      </header>
      <% if (events.length> 0) { %>
        <div class="grid">
          <style>
            dl {
              display: grid;
              grid-template-columns: auto auto;
            }
            dt {
              grid-column-start: 1;
            }
            dd {
              grid-column-start: 2;
              margin: 0;
            }
            a[role="button"] {
              --pico-box-shadow: var(--pico-card-box-shadow);
            }
            a[role="button"]:hover {
              --pico-box-shadow: var(--pico-button-hover-box-shadow);
            }
          </style>
          <% events.forEach(event => { %>
            <a role="button" class="outline" href="/admin/<%= event.id %>">
              <header>
                <h4>
                  <%= event.title %>
                </h4>
              </header>
              <p>
                <span>
                  <%= new Date(event.date).toLocaleString() %>
                </span>
                <dl>
                  <dt>Invited:</dt>
                  <dd>
                    <%= event.stats.potentialGuests %>
                  </dd>
                  <dt>Attending:</dt>
                  <dd>
                    <%= event.stats.guestsAttending %>
                  </dd>
                  <dt>Regrets:</dt>
                  <dd>
                    <%= event.stats.guestsNotAttending %>
                  </dd>
                </dl>
              </p>
            </a>
          <% }); %>
        </div>
      <% } else { %>
        <p><em>You haven't created any events yet.</em></p>
      <% } %>
      <footer>
        <details name="create">
          <summary role="button">Create new event</summary>
          <form action="/admin/event" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">

            <fieldset>
              <label>
                Event title
                <input type="text" name="title" placeholder="My awesome party" required />
              </label>
              <label>
                Event date and start time
                <input type="datetime-local" name="date" required />
              </label>
              <label>
                Event timezone (defaults to yours)
                <select name="timezone">
                  <option value="?">Pick a timezone - we couldn't find yours :(</option>
                  <% if (typeof timezones !=='undefined' && timezones.length> 0) { %>
                    <% timezones.forEach(tz=> { %>
                      <option value="<%= tz %>">
                        <%= tz %>
                      </option>
                      <% }); %>
                        <% } else { %>
                          <option value="" disabled>No timezones available</option>
                          <% } %>
                </select>
                <script>
                  document.addEventListener('DOMContentLoaded', function () {
                    const timezoneSelect = document.querySelector('select[name="timezone"]');
                    if (timezoneSelect && timezoneSelect.options.length > 1) {
                      if (timezoneSelect.selectedIndex === 0) {
                        // disable the first (placeholder) option
                        timezoneSelect.options[0].disabled = true;
                        const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                        for (let option of timezoneSelect.options) {
                          if (option.value === userTimezone) {
                            option.selected = true;
                            break;
                          }
                        }
                      }
                    }
                  });
                </script>
              </label>
            </fieldset>
            <input type="submit" value="Create it! ðŸŽ‰" />
          </form>
        </details>
      </footer>
    </article>
  </main>
</body>

</html>