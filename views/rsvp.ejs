<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('header'); %>
    <title>
        RSVP - <%= attendee.event_title %>
    </title>
    <style>
        .event-banner {
            width: 100%;
            max-height: 300px; /* Adjust as needed */
            object-fit: cover; /* Crop image to fit, maintaining aspect ratio */
            margin-bottom: 1rem;
            border-radius: 3px; /* Optional: if your card has rounded corners */
        }
        .card {
            /* Ensure card can contain the image nicely */
            overflow: hidden; /* If banner is first child and has different radius */
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">  <%# todo: separate to a sub-'component' template %>
            <% if (attendee.event_banner_image_filename) { %>
                <img src="/static/uploads/event-banners/<%= attendee.event_banner_image_filename %>" alt="<%= attendee.event_title %> Banner" class="event-banner">
            <% } %>
            <div class="card-header">
                <h1 class="card-header-title">
                    <%= attendee.event_title %>
                </h1>
            </div>
            <p class="date">
                <span class="local-datetime" data-timestamp="<%= attendee.event_date %>">
                    <%= new Date(attendee.event_date).toLocaleString() %>
                </span>
            </p>
            <% if (attendee.event_desc) { %>
                <p class="description"><%- attendee.event_desc %></p>
                <% } %>
        </div>

        <%# todo: htmx island %>
        <form action="/rsvp/<%= attendee.token %>" method="POST" class="rsvp-form">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <label for="name_disabled">
                Your Name:
                <input type="text" id="name_disabled" name="name_display" value="<%= attendee.name %>" disabled />
            </label>
            <fieldset>
                <legend>Will you attend?</legend>
                <label><input type="radio" name="rsvp" value="yes" <% if (attendee.rsvp==='yes' ) { %>checked<% } %>
                        required /> Yes</label>
                <label><input type="radio" name="rsvp" value="no" <% if (attendee.rsvp==='no' ) { %>checked<% } %> />
                        No</label>
            </fieldset>
            <label for="party_size_rsvp">
                Total people attending:
                <%# TODO: basic reactivity: grey this out iff rsvp===no %>
                <input type="number" id="party_size_rsvp" name="party_size" min="1" value="<%= attendee.party_size %>"
                    required />
            </label>
            <button class="button is-primary" type="submit">Respond</button>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/dayjs.min.js" integrity="sha512-FwNWaxyfy2XlEINoSnZh1JQ5TRRtGow0D6XcmAWmYCRgvqOUTnzCxPc9uF35u5ZEpirk1uhlPVA19tflhvnW1g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/plugin/utc.min.js" integrity="sha512-z84O912dDT9nKqvpBnl1tri5IN0j/OEgMzLN1GlkpKLMscs5ZHVu+G2CYtA6dkS0YnOGi3cODt3BOPnYc8Agjg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/plugin/timezone.min.js" integrity="sha512-nrkE2nl0pcqWefIY627DY1exPOSuZXMdOrxMxX0y7Ly6RH8K0WDjO1lqakkxQcX5m8hxoUSt75seRRiyhqPvIw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.13/plugin/localizedFormat.min.js" integrity="sha512-vjS0MkqX58pv35Mv03gzee3TSJ74Gg5lPkgel1V8czy+sTX/ZoFMs/FqnGzWpf3IV+Ry3/mJ0i9nANcjKk1fBg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        dayjs.extend(dayjs_plugin_utc);
        dayjs.extend(dayjs_plugin_timezone);
        dayjs.extend(dayjs_plugin_localizedFormat);

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.local-datetime').forEach(el => {
                const timestamp = el.dataset.timestamp;
                if (timestamp && !isNaN(Number(timestamp))) {
                    // 'L LT' is a localized format like "MM/DD/YYYY h:mm A"
                    // You can change the format string as needed, e.g., 'dddd, MMMM D, YYYY h:mm A' for a fuller format
                    el.textContent = dayjs(Number(timestamp)).format('dddd, MMMM D, YYYY LT');
                }
            });

            // Basic reactivity for party size based on RSVP choice
            const rsvpRadios = document.querySelectorAll('input[name="rsvp"]');
            const partySizeInput = document.getElementById('party_size_rsvp');

            function togglePartySize() {
                if (document.querySelector('input[name="rsvp"][value="no"]:checked')) {
                    partySizeInput.disabled = true;
                    partySizeInput.style.backgroundColor = '#e9ecef'; // Light grey out
                } else {
                    partySizeInput.disabled = false;
                    partySizeInput.style.backgroundColor = '';
                }
            }
            rsvpRadios.forEach(radio => radio.addEventListener('change', togglePartySize));
            togglePartySize(); // Initial state
        });
    </script>
</body>

</html>
