<%# SPDX-License-Identifier: AGPL-3.0-or-later %>
<%# Copyright (C) 2025 Chris Danis %>
<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('header'); %>
    <title>
        you're invited: <%= attendee.event_title %>
    </title>

    <style>
        .event-banner {
            width: 100%;
            object-fit: contain;
            max-height: 90vh;
        }
        @media (max-width: 1024px) {
            .event-banner {
                max-height: 60vh;
            }
        }
    </style>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
</head>

<body>
    <main class="container">
        <div class="grid">
<%# Event Preview Card: this includes an <article> start tag but not the end tag %>
            <%- include('event-display', { 
                attendee: attendee, 
                showIcsDownload: true,
                timeElementId: 'event-start-time',
                endTimeElementId: 'event-end-time'
            }) %>
            <hr />
            <section>
                <form action="/rsvp/<%= attendee.token %>" method="POST" class="rsvp-form">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <label>
                    You are:
                    <input type="text" name="name_display" value="<%= attendee.name %>" disabled />
                </label>
                <fieldset>
                    <legend>Will you attend?</legend>
                    <label><input type="radio" name="rsvp" value="yes" <% if (attendee.rsvp==='yes') { %>checked<% } %>
                            required /> Yes</label>
                    <label><input type="radio" name="rsvp" value="no" <% if (attendee.rsvp==='no') { %>checked<% } %>
                            />
                            No</label>
                </fieldset>
                <label for="party_size_rsvp">
                    Total people in your group (including you!):
                    <input type="number" id="party_size_rsvp" name="party_size" min="1"
                        value="<%= attendee.party_size %>" required />
                </label>
                <input type="submit" value="Respond ðŸ“©"/>
            </form>

            </section>
            </article>
        </div>
    </main>
    <%- include('date-formatter-script') %>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const rsvpRadios = document.querySelectorAll('input[name="rsvp"]');
            const partySizeInput = document.getElementById('party_size_rsvp');

            function togglePartySize() {
                if (document.querySelector('input[name="rsvp"][value="no"]:checked')) {
                    partySizeInput.disabled = true;
                    partySizeInput.style.backgroundColor = '#e9ecef';
                } else {
                    partySizeInput.disabled = false;
                    partySizeInput.style.backgroundColor = '';
                }
            }
            rsvpRadios.forEach(radio => radio.addEventListener('change', togglePartySize));
            togglePartySize();
        });
    </script>
</body>

</html>
