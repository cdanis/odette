<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('header'); %>
    <title>
        you're invited: <%= attendee.event_title %>
    </title>

    <style>
        .event-banner {
            width: 100%;
            object-fit: contain;
            max-height: 90vh;
        }
        @media (max-width: 1024px) {
            .event-banner {
                max-height: 60vh;
            }
        }
    </style>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
</head>

<body>
    <main class="container">
        <div class="grid">
            <% if (attendee.event_banner_image_filename) { %>
                <figure><img src="/uploads/event-banners/<%= attendee.event_banner_image_filename %>"
                        alt="<%= attendee.event_title %> Banner" class="event-banner"></figure>
            <% } %>

            <article>
                <header>
                    <h2>
                        <%= attendee.event_title %>
                    </h2>
                </header>
                <section>
                <div class="add-to-calendar-container" style="margin-top: 0; margin-bottom: 0.5rem;">
                    <a href="/ics/<%= attendee.token %>" role="button" download>
                        <span>ðŸ“… Add to Calendar</span>
                    </a>
                </div>
                <div style="padding-bottom: 0.33rem;">
                    <div>
                        <span id="event-start-time" class="local-datetime"
                            data-timestamp="<%= attendee.event_date %>">
                            <%= new Date(attendee.event_date).toLocaleString() %>
                        </span>
                    </div>
                    <div>
                        <% if (attendee.event_location_name || attendee.event_location_href) { %>
                            <% if (attendee.event_location_href) { %>
                                <a href="<%= attendee.event_location_href %>" target="_blank">
                                    <%= attendee.event_location_name || 'Location' %>
                                </a>
                            <% } else { %>
                                <%= attendee.event_location_name %>
                            <% } %>
                        <% } %>
                    </div>
                </div>
            </section>
            <% if (attendee.event_desc) { %>
                <section>
                    <p class="description"><%- attendee.event_desc %></p>
                </section>
            <% } %>
            <hr />
            <section>
                <form action="/rsvp/<%= attendee.token %>" method="POST" class="rsvp-form">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <label>
                    You are:
                    <input type="text" name="name_display" value="<%= attendee.name %>" disabled />
                </label>
                <fieldset>
                    <legend>Will you attend?</legend>
                    <label><input type="radio" name="rsvp" value="yes" <% if (attendee.rsvp==='yes') { %>checked<% } %>
                            required /> Yes</label>
                    <label><input type="radio" name="rsvp" value="no" <% if (attendee.rsvp==='no') { %>checked<% } %>
                            />
                            No</label>
                </fieldset>
                <label for="party_size_rsvp">
                    Total people in your group (including you!):
                    <input type="number" id="party_size_rsvp" name="party_size" min="1"
                        value="<%= attendee.party_size %>" required />
                </label>
                <input type="submit" value="Respond ðŸ“©"/>
            </form>

            </section>
            </article>
        </div>
    </main>
    <%- include('date-formatter-script') %>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const rsvpRadios = document.querySelectorAll('input[name="rsvp"]');
            const partySizeInput = document.getElementById('party_size_rsvp');

            function togglePartySize() {
                if (document.querySelector('input[name="rsvp"][value="no"]:checked')) {
                    partySizeInput.disabled = true;
                    partySizeInput.style.backgroundColor = '#e9ecef';
                } else {
                    partySizeInput.disabled = false;
                    partySizeInput.style.backgroundColor = '';
                }
            }
            rsvpRadios.forEach(radio => radio.addEventListener('change', togglePartySize));
            togglePartySize();
        });
    </script>
</body>

</html>
